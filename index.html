<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        #read,
        #text {
            width: 90%;
        }
    </style>
    <script src="//cdn.jsdelivr.net/npm/eruda"></script>
    <script>
        eruda.init();
    </script>
    <title>Dao3 Static Helper</title>
</head>

<body>
    <h1>Dao3 Static 工具</h1>
    <h2>读取</h2>
    输入Hash(不带后缀名): <br>
    <input type="text" id="read"><br>
    <button onclick="read()">读取</button><br>
    <h2>上传</h2>
    <h3>上传文本</h3>
    在这里输入上传的文本: <br>
    <textarea id="text" cols="30" rows="10"></textarea><br>
    <button onclick="postText()">上传文本</button><br>
    <h3>上传文件</h3>
    <input type="file" multiple="false" id="file" onchange="postFile()"><br>
    <h3>上传结果</h3>
    <p id="result"></p>
    <script>
        const resultDisplay = document.getElementById("result");
        function read() {
            const hash = document.getElementById("read").value;
            open(`//static.dao3.fun/block/${hash}.json`, "_blank");
        }
        async function post(data) {
            const postResult = await fetch("https://static.dao3.fun/block/", {
                method: "POST",
                headers: {
                    "Content-Type": "text/json"
                },
                body: data,
                mode: "cors"
            });
            const resultData = await postResult.json();
            resultDisplay.innerText = JSON.stringify(resultData);
        }
        function postFile() {
            const input = document.getElementById("file");
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = async function () {
                const data = reader.result;
                await post(data);
            };
            reader.readAsText(file);
        };
        async function postText() {
            const text = document.getElementById("text");
            const data = text.innerText;
            await post(data);
            text.innerText = "";
        }
    </script>
</body>

</html>